#!/bin/bash

# Unity Vibe CLI - Help Script
# Shows help information for Unity Vibe CLI commands
# Usage: unity-cli-help

# Check if Unity executable exists
UNITY_PATH=""
if command -v /mnt/c/Program\ Files/Unity/Hub/Editor/*/Editor/Unity.exe >/dev/null 2>&1; then
    UNITY_PATH=$(find /mnt/c/Program\ Files/Unity/Hub/Editor/*/Editor/Unity.exe | head -1)
elif command -v unity >/dev/null 2>&1; then
    UNITY_PATH="unity"
else
    echo "Error: Unity Editor not found. Please ensure Unity is installed and accessible."
    exit 1
fi

# Get current directory (assuming it's the Unity project root)
# Convert WSL path to Windows path for Unity
if [[ $(pwd) == /mnt/c/* ]]; then
    PROJECT_PATH=$(pwd | sed 's|/mnt/c|C:|')
else
    PROJECT_PATH=$(pwd)
fi

echo "Unity Vibe CLI - Help"
echo "===================="
echo "Project Path: $PROJECT_PATH"
echo ""

# Execute Unity command with log output
"$UNITY_PATH" \
    -batchmode \
    -quit \
    -projectPath "$PROJECT_PATH" \
    -executeMethod UnityVibe.Editor.CLI.ShowHelpFromCommandLine \
    -logFile - 2>/dev/null | grep -E "\[UnityCLI\]"

# Check exit code
if [ $? -eq 0 ]; then
    echo ""
    echo "✅ Help displayed successfully"
else
    echo ""
    echo "❌ Failed to display help. Check Unity console for details."
    exit 1
fi